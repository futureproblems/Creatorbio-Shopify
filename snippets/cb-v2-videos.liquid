{%- comment -%}
  CB Commerce V2 - Videos Component
  Displays embedded videos from YouTube, YouTube Shorts, TikTok, Instagram Reels, and Vimeo
  Layout matches creatorb-app [username]/page.tsx
{%- endcomment -%}

{%- if videos_json != blank -%}
  {%- assign videos = videos_json | parse_json -%}
{%- else -%}
  {%- assign videos = nil -%}
{%- endif -%}

{%- if videos != blank and videos.size > 0 -%}
  {%- assign youtube_videos = '' -%}
  {%- assign youtube_shorts_videos = '' -%}
  {%- assign tiktok_videos = '' -%}
  {%- assign instagram_videos = '' -%}
  {%- assign vimeo_videos = '' -%}

  {%- for video in videos -%}
    {%- if video.platform == 'youtube' -%}
      {%- if youtube_videos == '' -%}
        {%- assign youtube_videos = video.url -%}
      {%- else -%}
        {%- assign youtube_videos = youtube_videos | append: '|||' | append: video.url -%}
      {%- endif -%}
    {%- elsif video.platform == 'youtube_shorts' -%}
      {%- if youtube_shorts_videos == '' -%}
        {%- assign youtube_shorts_videos = video.url -%}
      {%- else -%}
        {%- assign youtube_shorts_videos = youtube_shorts_videos | append: '|||' | append: video.url -%}
      {%- endif -%}
    {%- elsif video.platform == 'tiktok' -%}
      {%- if tiktok_videos == '' -%}
        {%- assign tiktok_videos = video.url -%}
      {%- else -%}
        {%- assign tiktok_videos = tiktok_videos | append: '|||' | append: video.url -%}
      {%- endif -%}
    {%- elsif video.platform == 'instagram_reels' or video.platform == 'instagram' -%}
      {%- if instagram_videos == '' -%}
        {%- assign instagram_videos = video.url -%}
      {%- else -%}
        {%- assign instagram_videos = instagram_videos | append: '|||' | append: video.url -%}
      {%- endif -%}
    {%- elsif video.platform == 'vimeo' -%}
      {%- if vimeo_videos == '' -%}
        {%- assign vimeo_videos = video.url -%}
      {%- else -%}
        {%- assign vimeo_videos = vimeo_videos | append: '|||' | append: video.url -%}
      {%- endif -%}
    {%- endif -%}
  {%- endfor -%}

  <div class="cb-videos">

    {%- comment -%} ========== YOUTUBE (Landscape) ========== {%- endcomment -%}
    {%- if youtube_videos != '' -%}
      {%- assign youtube_array = youtube_videos | split: '|||' -%}
      <div class="cb-videos__section">
        <h4 class="cb-videos__heading">YouTube</h4>
        <div class="cb-videos__grid-landscape">
          {%- for video_url in youtube_array -%}
            {%- assign video_id = '' -%}
            {%- if video_url contains 'youtube.com/watch' -%}
              {%- assign video_id = video_url | split: 'v=' | last | split: '&' | first -%}
            {%- elsif video_url contains 'youtu.be/' -%}
              {%- assign video_id = video_url | split: 'youtu.be/' | last | split: '?' | first -%}
            {%- endif -%}

            {%- if video_id != blank -%}
              <div class="cb-video-card cb-video-card--landscape">
                <iframe
                  src="https://www.youtube.com/embed/{{ video_id }}"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen
                  loading="lazy"
                  title="YouTube video"
                ></iframe>
              </div>
            {%- endif -%}
          {%- endfor -%}
        </div>
      </div>
    {%- endif -%}

    {%- comment -%} ========== YOUTUBE SHORTS (Portrait, side-by-side) ========== {%- endcomment -%}
    {%- if youtube_shorts_videos != '' -%}
      {%- assign shorts_array = youtube_shorts_videos | split: '|||' -%}
      <div class="cb-videos__section">
        <h4 class="cb-videos__heading">YouTube Shorts</h4>
        <div class="cb-videos__grid-shorts">
          {%- for video_url in shorts_array -%}
            {%- assign video_id = '' -%}
            {%- if video_url contains '/shorts/' -%}
              {%- assign video_id = video_url | split: '/shorts/' | last | split: '?' | first -%}
            {%- endif -%}

            {%- if video_id != blank -%}
              <div class="cb-video-card cb-video-card--portrait">
                <iframe
                  src="https://www.youtube.com/embed/{{ video_id }}"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen
                  loading="lazy"
                  title="YouTube Shorts"
                ></iframe>
              </div>
            {%- endif -%}
          {%- endfor -%}
        </div>
      </div>
    {%- endif -%}

    {%- comment -%} ========== TIKTOK (Portrait, centered) - Beacons approach ========== {%- endcomment -%}
    {%- if tiktok_videos != '' -%}
      {%- assign tiktok_array = tiktok_videos | split: '|||' -%}
      <script async src="https://www.tiktok.com/embed.js"></script>

      <div class="cb-videos__section">
        <h4 class="cb-videos__heading">TikTok</h4>
        <div class="cb-videos__centered">
          {%- for video_url in tiktok_array -%}
            {%- assign video_id = '' -%}
            {%- if video_url contains '/video/' -%}
              {%- assign video_id = video_url | split: '/video/' | last | split: '?' | first -%}
            {%- endif -%}

            {%- if video_id != blank -%}
              {%- comment -%} Outer glassmorphism container {%- endcomment -%}
              <div class="cb-tiktok-outer">
                {%- comment -%} Ratio container for responsive sizing {%- endcomment -%}
                <div class="cb-tiktok-ratio">
                  <div class="cb-tiktok-wrapper">
                    <iframe
                      src="https://www.tiktok.com/embed/{{ video_id }}"
                      frameborder="0"
                      scrolling="no"
                      allowfullscreen
                      allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
                      title="TikTok video"
                    ></iframe>
                  </div>
                </div>
              </div>
            {%- endif -%}
          {%- endfor -%}
        </div>
      </div>
    {%- endif -%}

    {%- comment -%} ========== INSTAGRAM REELS (Portrait, centered) ========== {%- endcomment -%}
    {%- if instagram_videos != '' -%}
      {%- assign instagram_array = instagram_videos | split: '|||' -%}
      <div class="cb-videos__section">
        <h4 class="cb-videos__heading">Instagram</h4>
        <div class="cb-videos__centered">
          {%- for ig_url in instagram_array -%}
            {%- assign video_id = '' -%}
            {%- if ig_url contains '/reel/' -%}
              {%- assign video_id = ig_url | split: '/reel/' | last | split: '/' | first | split: '?' | first -%}
            {%- elsif ig_url contains '/p/' -%}
              {%- assign video_id = ig_url | split: '/p/' | last | split: '/' | first | split: '?' | first -%}
            {%- endif -%}

            {%- if video_id != blank -%}
              <div class="cb-video-card cb-video-card--instagram">
                <iframe
                  src="https://www.instagram.com/p/{{ video_id }}/embed"
                  frameborder="0"
                  scrolling="no"
                  allowtransparency="true"
                  allowfullscreen
                  loading="lazy"
                  title="Instagram"
                ></iframe>
              </div>
            {%- endif -%}
          {%- endfor -%}
        </div>
      </div>
    {%- endif -%}

    {%- comment -%} ========== VIMEO (Landscape) ========== {%- endcomment -%}
    {%- if vimeo_videos != '' -%}
      {%- assign vimeo_array = vimeo_videos | split: '|||' -%}
      <div class="cb-videos__section">
        <h4 class="cb-videos__heading">Vimeo</h4>
        <div class="cb-videos__grid-landscape">
          {%- for video_url in vimeo_array -%}
            {%- assign video_id = '' -%}
            {%- if video_url contains 'vimeo.com/' -%}
              {%- assign video_id = video_url | split: 'vimeo.com/' | last | split: '?' | first | split: '/' | first -%}
            {%- endif -%}

            {%- if video_id != blank -%}
              <div class="cb-video-card cb-video-card--landscape">
                <iframe
                  src="https://player.vimeo.com/video/{{ video_id }}"
                  allow="autoplay; fullscreen; picture-in-picture"
                  allowfullscreen
                  loading="lazy"
                  title="Vimeo video"
                ></iframe>
              </div>
            {%- endif -%}
          {%- endfor -%}
        </div>
      </div>
    {%- endif -%}

  </div>
{%- endif -%}

<style>
  /* ========================================
     CB Commerce V2 - Videos Styles
     Matching [username]/page.tsx layout
  ======================================== */

  .cb-videos {
    padding: 0;
  }

  .cb-videos__section {
    margin-bottom: 32px;
  }

  .cb-videos__section:last-child {
    margin-bottom: 0;
  }

  /* Section Headings - Uppercase like bio page */
  .cb-videos__heading {
    font-size: 14px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--cb-text-primary, #fff);
    text-align: center;
    margin: 0 0 16px 0;
  }

  /* ========================================
     Layout Containers
  ======================================== */

  /* Landscape videos - full width stack */
  .cb-videos__grid-landscape {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  /* Portrait videos (Shorts) - side by side */
  .cb-videos__grid-shorts {
    display: flex;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
  }

  /* Centered single videos (TikTok, Instagram) */
  .cb-videos__centered {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
  }

  /* ========================================
     Video Cards
  ======================================== */

  .cb-video-card {
    position: relative;
    border-radius: 12px;
    overflow: hidden;
    background: #000;
  }

  .cb-video-card iframe {
    width: 100%;
    height: 100%;
    border: none;
    display: block;
  }

  /* Landscape (YouTube, Vimeo) - 16:9 */
  .cb-video-card--landscape {
    width: 100%;
    aspect-ratio: 16/9;
  }

  /* Portrait (YouTube Shorts) - 9:16, max 300px width */
  .cb-video-card--portrait {
    width: 100%;
    max-width: 180px;
    aspect-ratio: 9/16;
  }

  /* TikTok - Outer glassmorphism container (Beacons approach) */
  .cb-tiktok-outer {
    width: 100%;
    max-width: 325px;
    border-radius: 16px;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    padding: 8px;
    overflow: hidden;
  }

  /* TikTok - Ratio container (9:16 = 177.78%) */
  .cb-tiktok-ratio {
    position: relative;
    width: 100%;
    padding-top: 177.77777778%;
    border-radius: 12px;
    overflow: hidden;
    background: #000;
  }

  /* TikTok - Wrapper with scale transform */
  .cb-tiktok-wrapper {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    overflow: hidden;
  }

  /* TikTok iframe - scaled down to fit */
  .cb-tiktok-wrapper iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
    overflow: hidden;
    transform: scale(0.96);
    transform-origin: top center;
    margin-top: -14px;
  }

  /* Instagram - fixed size */
  .cb-video-card--instagram {
    width: 300px;
    max-width: 100%;
    aspect-ratio: 9/16;
  }

  /* ========================================
     Mobile Adjustments
  ======================================== */
  @media (max-width: 430px) {
    .cb-videos__heading {
      font-size: 12px;
    }

    .cb-videos__grid-shorts {
      gap: 12px;
    }

    .cb-video-card--portrait {
      max-width: 150px;
    }

    .cb-tiktok-outer {
      max-width: 290px;
    }

    .cb-video-card--instagram {
      width: 260px;
    }
  }

  @media (max-width: 380px) {
    .cb-video-card--portrait {
      max-width: 130px;
    }

    .cb-tiktok-outer {
      max-width: 270px;
      padding: 6px;
    }

    .cb-video-card--instagram {
      width: 240px;
    }
  }

  /* Extra small screens */
  @media (max-width: 340px) {
    .cb-tiktok-outer {
      max-width: calc(100vw - 40px);
      padding: 5px;
    }
  }
</style>
