{%- comment -%}
  CB Commerce V2 - Videos Component
  Displays embedded videos from YouTube, YouTube Shorts, TikTok, Instagram Reels, and Vimeo
  Layout matches creatorb-app [username]/page.tsx
{%- endcomment -%}

{%- if videos_json != blank -%}
  {%- assign videos = videos_json | parse_json -%}
{%- else -%}
  {%- assign videos = nil -%}
{%- endif -%}

{%- if videos != blank and videos.size > 0 -%}
  {%- assign youtube_videos = '' -%}
  {%- assign youtube_shorts_videos = '' -%}
  {%- assign tiktok_videos = '' -%}
  {%- assign instagram_videos = '' -%}
  {%- assign vimeo_videos = '' -%}

  {%- for video in videos -%}
    {%- if video.platform == 'youtube' -%}
      {%- if youtube_videos == '' -%}
        {%- assign youtube_videos = video.url -%}
      {%- else -%}
        {%- assign youtube_videos = youtube_videos | append: '|||' | append: video.url -%}
      {%- endif -%}
    {%- elsif video.platform == 'youtube_shorts' -%}
      {%- if youtube_shorts_videos == '' -%}
        {%- assign youtube_shorts_videos = video.url -%}
      {%- else -%}
        {%- assign youtube_shorts_videos = youtube_shorts_videos | append: '|||' | append: video.url -%}
      {%- endif -%}
    {%- elsif video.platform == 'tiktok' -%}
      {%- if tiktok_videos == '' -%}
        {%- assign tiktok_videos = video.url -%}
      {%- else -%}
        {%- assign tiktok_videos = tiktok_videos | append: '|||' | append: video.url -%}
      {%- endif -%}
    {%- elsif video.platform == 'instagram_reels' or video.platform == 'instagram' -%}
      {%- if instagram_videos == '' -%}
        {%- assign instagram_videos = video.url -%}
      {%- else -%}
        {%- assign instagram_videos = instagram_videos | append: '|||' | append: video.url -%}
      {%- endif -%}
    {%- elsif video.platform == 'vimeo' -%}
      {%- if vimeo_videos == '' -%}
        {%- assign vimeo_videos = video.url -%}
      {%- else -%}
        {%- assign vimeo_videos = vimeo_videos | append: '|||' | append: video.url -%}
      {%- endif -%}
    {%- endif -%}
  {%- endfor -%}

  <div class="cb-videos">

    {%- comment -%} ========== YOUTUBE (Landscape) ========== {%- endcomment -%}
    {%- if youtube_videos != '' -%}
      {%- assign youtube_array = youtube_videos | split: '|||' -%}
      <div class="cb-videos__section">
        <h4 class="cb-videos__heading">YouTube</h4>
        <div class="cb-videos__grid-landscape">
          {%- for video_url in youtube_array -%}
            {%- assign video_id = '' -%}
            {%- if video_url contains 'youtube.com/watch' -%}
              {%- assign video_id = video_url | split: 'v=' | last | split: '&' | first -%}
            {%- elsif video_url contains 'youtu.be/' -%}
              {%- assign video_id = video_url | split: 'youtu.be/' | last | split: '?' | first -%}
            {%- endif -%}

            {%- if video_id != blank -%}
              <div class="cb-video-card cb-video-card--landscape">
                <iframe
                  src="https://www.youtube.com/embed/{{ video_id }}"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen
                  loading="lazy"
                  title="YouTube video"
                ></iframe>
              </div>
            {%- endif -%}
          {%- endfor -%}
        </div>
      </div>
    {%- endif -%}

    {%- comment -%} ========== YOUTUBE SHORTS (Portrait, side-by-side) ========== {%- endcomment -%}
    {%- if youtube_shorts_videos != '' -%}
      {%- assign shorts_array = youtube_shorts_videos | split: '|||' -%}
      <div class="cb-videos__section">
        <h4 class="cb-videos__heading">YouTube Shorts</h4>
        <div class="cb-videos__grid-shorts">
          {%- for video_url in shorts_array -%}
            {%- assign video_id = '' -%}
            {%- if video_url contains '/shorts/' -%}
              {%- assign video_id = video_url | split: '/shorts/' | last | split: '?' | first -%}
            {%- endif -%}

            {%- if video_id != blank -%}
              <div class="cb-video-card cb-video-card--portrait">
                <iframe
                  src="https://www.youtube.com/embed/{{ video_id }}"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen
                  loading="lazy"
                  title="YouTube Shorts"
                ></iframe>
              </div>
            {%- endif -%}
          {%- endfor -%}
        </div>
      </div>
    {%- endif -%}

    {%- comment -%} ========== TIKTOK (Portrait, centered) - Cover with link ========== {%- endcomment -%}
    {%- if tiktok_videos != '' -%}
      {%- assign tiktok_array = tiktok_videos | split: '|||' -%}

      <div class="cb-videos__section">
        <h4 class="cb-videos__heading">TikTok</h4>
        <div class="cb-videos__centered">
          {%- for video_url in tiktok_array -%}
            {%- assign video_id = '' -%}
            {%- if video_url contains '/video/' -%}
              {%- assign video_id = video_url | split: '/video/' | last | split: '?' | first -%}
            {%- endif -%}

            {%- if video_id != blank -%}
              <a href="{{ video_url }}" target="_blank" rel="noopener" class="cb-tiktok-cover">
                <div class="cb-tiktok-cover__inner">
                  {%- comment -%} TikTok logo {%- endcomment -%}
                  <div class="cb-tiktok-cover__logo">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="white">
                      <path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/>
                    </svg>
                  </div>
                  {%- comment -%} Play button {%- endcomment -%}
                  <div class="cb-tiktok-cover__play">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="white">
                      <path d="M8 5v14l11-7z"/>
                    </svg>
                  </div>
                  <span class="cb-tiktok-cover__text">Watch on TikTok</span>
                </div>
              </a>
            {%- endif -%}
          {%- endfor -%}
        </div>
      </div>
    {%- endif -%}

    {%- comment -%} ========== INSTAGRAM REELS (Portrait, centered) ========== {%- endcomment -%}
    {%- if instagram_videos != '' -%}
      {%- assign instagram_array = instagram_videos | split: '|||' -%}
      <div class="cb-videos__section">
        <h4 class="cb-videos__heading">Instagram</h4>
        <div class="cb-videos__centered">
          {%- for ig_url in instagram_array -%}
            {%- assign video_id = '' -%}
            {%- if ig_url contains '/reel/' -%}
              {%- assign video_id = ig_url | split: '/reel/' | last | split: '/' | first | split: '?' | first -%}
            {%- elsif ig_url contains '/p/' -%}
              {%- assign video_id = ig_url | split: '/p/' | last | split: '/' | first | split: '?' | first -%}
            {%- endif -%}

            {%- if video_id != blank -%}
              <div class="cb-video-card cb-video-card--instagram">
                <iframe
                  src="https://www.instagram.com/p/{{ video_id }}/embed"
                  frameborder="0"
                  scrolling="no"
                  allowtransparency="true"
                  allowfullscreen
                  loading="lazy"
                  title="Instagram"
                ></iframe>
              </div>
            {%- endif -%}
          {%- endfor -%}
        </div>
      </div>
    {%- endif -%}

    {%- comment -%} ========== VIMEO (Landscape) ========== {%- endcomment -%}
    {%- if vimeo_videos != '' -%}
      {%- assign vimeo_array = vimeo_videos | split: '|||' -%}
      <div class="cb-videos__section">
        <h4 class="cb-videos__heading">Vimeo</h4>
        <div class="cb-videos__grid-landscape">
          {%- for video_url in vimeo_array -%}
            {%- assign video_id = '' -%}
            {%- if video_url contains 'vimeo.com/' -%}
              {%- assign video_id = video_url | split: 'vimeo.com/' | last | split: '?' | first | split: '/' | first -%}
            {%- endif -%}

            {%- if video_id != blank -%}
              <div class="cb-video-card cb-video-card--landscape">
                <iframe
                  src="https://player.vimeo.com/video/{{ video_id }}"
                  allow="autoplay; fullscreen; picture-in-picture"
                  allowfullscreen
                  loading="lazy"
                  title="Vimeo video"
                ></iframe>
              </div>
            {%- endif -%}
          {%- endfor -%}
        </div>
      </div>
    {%- endif -%}

  </div>
{%- endif -%}

<style>
  /* ========================================
     CB Commerce V2 - Videos Styles
     Matching [username]/page.tsx layout
  ======================================== */

  .cb-videos {
    padding: 0;
  }

  .cb-videos__section {
    margin-bottom: 32px;
  }

  .cb-videos__section:last-child {
    margin-bottom: 0;
  }

  /* Section Headings - Uppercase like bio page */
  .cb-videos__heading {
    font-size: 14px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--cb-text-primary, #fff);
    text-align: center;
    margin: 0 0 16px 0;
  }

  /* ========================================
     Layout Containers
  ======================================== */

  /* Landscape videos - full width stack */
  .cb-videos__grid-landscape {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  /* Portrait videos (Shorts) - side by side */
  .cb-videos__grid-shorts {
    display: flex;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
  }

  /* Centered single videos (TikTok, Instagram) */
  .cb-videos__centered {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
  }

  /* ========================================
     Video Cards
  ======================================== */

  .cb-video-card {
    position: relative;
    border-radius: 12px;
    overflow: hidden;
    background: #000;
  }

  .cb-video-card iframe {
    width: 100%;
    height: 100%;
    border: none;
    display: block;
  }

  /* Landscape (YouTube, Vimeo) - 16:9 */
  .cb-video-card--landscape {
    width: 100%;
    aspect-ratio: 16/9;
  }

  /* Portrait (YouTube Shorts) - 9:16, max 300px width */
  .cb-video-card--portrait {
    width: 100%;
    max-width: 180px;
    aspect-ratio: 9/16;
  }

  /* TikTok - Cover card with link */
  .cb-tiktok-cover {
    display: block;
    width: 100%;
    max-width: 280px;
    aspect-ratio: 9/16;
    border-radius: 16px;
    overflow: hidden;
    text-decoration: none;
    background: linear-gradient(135deg, #000 0%, #1a1a1a 100%);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .cb-tiktok-cover:hover {
    transform: scale(1.02);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
  }

  .cb-tiktok-cover__inner {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 16px;
    background: linear-gradient(135deg,
      rgba(254, 44, 85, 0.2) 0%,
      rgba(37, 244, 238, 0.1) 50%,
      rgba(0, 0, 0, 0.8) 100%
    );
  }

  .cb-tiktok-cover__logo {
    opacity: 0.9;
  }

  .cb-tiktok-cover__play {
    width: 72px;
    height: 72px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid rgba(255, 255, 255, 0.3);
  }

  .cb-tiktok-cover__text {
    color: rgba(255, 255, 255, 0.8);
    font-size: 14px;
    font-weight: 500;
  }

  /* Instagram - fixed size */
  .cb-video-card--instagram {
    width: 300px;
    max-width: 100%;
    aspect-ratio: 9/16;
  }

  /* ========================================
     Mobile Adjustments
  ======================================== */
  @media (max-width: 430px) {
    .cb-videos__heading {
      font-size: 12px;
    }

    .cb-videos__grid-shorts {
      gap: 12px;
    }

    .cb-video-card--portrait {
      max-width: 150px;
    }

    .cb-tiktok-cover {
      max-width: 240px;
    }

    .cb-video-card--instagram {
      width: 260px;
    }
  }

  @media (max-width: 380px) {
    .cb-video-card--portrait {
      max-width: 130px;
    }

    .cb-tiktok-cover {
      max-width: 200px;
    }

    .cb-video-card--instagram {
      width: 240px;
    }
  }
</style>
