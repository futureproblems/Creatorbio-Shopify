{%- comment -%}
  CB Commerce V2 - Browse View Component
  Contained shop section with horizontal scroll products and view states
  States: grid → product → details → cart

  Required variables:
  - creator_name: For section header
  - username: Creator username
  - collection: Shopify collection object
  - categories_array: Array of category strings
  - links_json: JSON string of links
  - videos_json: JSON string of video embeds (YouTube, TikTok, etc.)
  - social_stats: Social stats object
  - instagram_url, tiktok_url, youtube_url, twitter_url: Social URLs
  - enable_music_player: Boolean to enable music player
  - music_player_title: Title for music section
  - music_player_theme: Spotify theme (auto/white/black)
  - music_items: Array of music items with url/title
{%- endcomment -%}

<div class="cb-view cb-view--browse" data-view-content="browse">

  {%- comment -%} ========== CONTAINED SHOP SECTION ========== {%- endcomment -%}
  <div class="cb-shop" data-shop-view="grid">
    {%- comment -%} Dynamic Header {%- endcomment -%}
    <div class="cb-shop__header">
      {%- comment -%} Left side - title or back button {%- endcomment -%}
      <div class="cb-shop__header-left">
        <h2 class="cb-shop__title" data-shop-header-grid>
          {{ creator_name | split: ' ' | first | upcase | default: 'CREATOR' }} PICKS
        </h2>
        <button class="cb-shop__back-btn" data-shop-header-product data-action="shop-back-to-grid" style="display: none;">
          ← BACK TO ALL
        </button>
        <button class="cb-shop__back-btn" data-shop-header-details data-action="shop-back-to-product" style="display: none;">
          ← BACK
        </button>
        <button class="cb-shop__back-btn" data-shop-header-cart data-action="shop-back-to-grid" style="display: none;">
          ← BACK
        </button>
      </div>

      {%- comment -%} Center - cart title {%- endcomment -%}
      <span class="cb-shop__title" data-shop-cart-title style="display: none;">CART</span>

      {%- comment -%} Right side - details link + cart button {%- endcomment -%}
      <div class="cb-shop__header-right">
        <button class="cb-shop__details-link" data-action="shop-show-details" style="display: none;">
          +details
        </button>
        <button class="cb-shop__cart-btn" data-action="shop-show-cart">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M6 6h15l-1.5 9h-12z"/>
            <circle cx="9" cy="20" r="1" fill="currentColor"/>
            <circle cx="18" cy="20" r="1" fill="currentColor"/>
            <path d="M6 6L5 3H2"/>
          </svg>
          <span class="cb-shop__cart-badge" data-shop-cart-count style="display: none;">0</span>
        </button>
      </div>
    </div>

    {%- comment -%} Category Tabs - Only in grid view {%- endcomment -%}
    <div class="cb-shop__categories" data-shop-categories>
      <button class="cb-shop__category active" data-category="all">All</button>
      {%- for category in categories_array -%}
        {%- if category != blank -%}
          <button class="cb-shop__category" data-category="{{ category | handleize }}">
            {{ category }}
          </button>
        {%- endif -%}
      {%- endfor -%}
    </div>

    {%- comment -%} Grid View - Horizontal scroll products {%- endcomment -%}
    <div class="cb-shop__products" data-shop-content="grid">
      {%- if collection != blank and collection.products.size > 0 -%}
        {%- for product in collection.products limit: 12 -%}
          <div class="cb-shop__product" data-action="shop-select-product" data-product-id="{{ product.id }}">
            <div class="cb-shop__product-image">
              {%- if product.featured_image != blank -%}
                <img
                  src="{{ product.featured_image | image_url: width: 400 }}"
                  alt="{{ product.title | escape }}"
                  loading="lazy"
                >
              {%- else -%}
                <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: #FAFAFA; font-size: 9px; color: #999;">
                  {{ product.title | truncate: 20 }}
                </div>
              {%- endif -%}
              <button class="cb-shop__product-add" data-action="shop-quick-add" data-product-id="{{ product.id }}">+</button>
            </div>
            <p class="cb-shop__product-name">{{ product.title | truncate: 30 }}</p>
            <p class="cb-shop__product-price" data-base-price="{{ product.price | money_without_currency | remove: ',' }}">
              {{ product.price | money }}
            </p>
            {%- comment -%} Embedded product data for JS {%- endcomment -%}
            <script type="application/json" class="cb-shop__product-data">
              {
                "id": {{ product.id | json }},
                "handle": {{ product.handle | json }},
                "title": {{ product.title | json }},
                "price": {{ product.price | divided_by: 100.0 }},
                "description": {{ product.description | strip_html | truncate: 500 | json }},
                "images": [
                  {%- for image in product.images limit: 4 -%}
                    "{{ image | image_url: width: 600 }}"{% unless forloop.last %},{% endunless %}
                  {%- endfor -%}
                ],
                "variants": [
                  {%- for variant in product.variants -%}
                    {
                      "id": {{ variant.id }},
                      "title": {{ variant.title | json }},
                      "option1": {{ variant.option1 | json }},
                      "available": {{ variant.available | json }},
                      "price": {{ variant.price | divided_by: 100.0 }}
                    }{% unless forloop.last %},{% endunless %}
                  {%- endfor -%}
                ]
              }
            </script>
          </div>
        {%- endfor -%}
      {%- else -%}
        <div style="text-align: center; color: #8B7D6B; padding: 40px 20px; width: 100%;">
          <p>No products available</p>
        </div>
      {%- endif -%}
    </div>

    {%- comment -%} Product View - Image Carousel {%- endcomment -%}
    <div class="cb-shop__product-view" data-shop-content="product" style="display: none;">
      <div class="cb-shop__carousel" data-shop-carousel>
        {%- comment -%} Carousel slides populated by JS {%- endcomment -%}
      </div>
      <div class="cb-shop__carousel-dots" data-shop-carousel-dots>
        {%- comment -%} Dots populated by JS {%- endcomment -%}
      </div>
      <div class="cb-shop__product-info">
        <div class="cb-shop__product-details">
          <p class="name" data-shop-product-title>Product Name</p>
          <p class="price" data-shop-product-price>$0.00</p>
        </div>
        <div class="cb-shop__sizes" data-shop-sizes>
          {%- comment -%} Size buttons populated by JS {%- endcomment -%}
        </div>
      </div>
    </div>

    {%- comment -%} Details View {%- endcomment -%}
    <div class="cb-shop__details-view" data-shop-content="details" style="display: none;">
      <div class="cb-shop__details-card">
        <h4>Description</h4>
        <p data-shop-description>Product description goes here...</p>
        <h4>Size & Fit</h4>
        <p data-shop-sizefit>True to size. Model wears size M.</p>
      </div>
    </div>

    {%- comment -%} Cart View {%- endcomment -%}
    <div class="cb-shop__cart-view" data-shop-content="cart" style="display: none;">
      <p class="cb-shop__cart-empty" data-shop-cart-empty>Your cart is empty</p>
      <div data-shop-cart-items>
        {%- comment -%} Cart items populated by JS {%- endcomment -%}
      </div>

      {%- comment -%} Checkout Footer - Only shows when cart has items {%- endcomment -%}
      <div class="cb-shop__checkout" data-shop-checkout style="display: none;">
        {%- comment -%} Cart Total {%- endcomment -%}
        <div class="cb-shop__checkout-total">
          <span>Total</span>
          <span data-shop-cart-total>$0.00</span>
        </div>

        {%- comment -%} Express Checkout Divider {%- endcomment -%}
        <div class="cb-shop__checkout-divider">
          <span>Express checkout</span>
        </div>

        {%- comment -%} Express Pay Buttons {%- endcomment -%}
        <div class="cb-shop__express-buttons">
          <button type="button" class="cb-shop__express-btn cb-shop__express-btn--apple" data-action="express-checkout" data-method="apple">
            <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
              <path d="M17.05 20.28c-.98.95-2.05.8-3.08.35-1.09-.46-2.09-.48-3.24 0-1.44.62-2.2.44-3.06-.35C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09l.01-.01zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z"/>
            </svg>
            <span>Pay</span>
          </button>
          <button type="button" class="cb-shop__express-btn cb-shop__express-btn--google" data-action="express-checkout" data-method="google">
            <svg viewBox="0 0 24 24" width="20" height="20">
              <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
              <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
              <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
              <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
            </svg>
            <span>Pay</span>
          </button>
          <button type="button" class="cb-shop__express-btn cb-shop__express-btn--shop" data-action="express-checkout" data-method="shop">
            <svg viewBox="0 0 341 81" fill="none" width="60" height="14">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M227.297 0C220.448 0 214.896 5.47237 214.896 12.2229V67.8125C214.896 74.563 220.448 80.0354 227.297 80.0354H328.357C335.206 80.0354 340.758 74.563 340.758 67.8125V12.2229C340.758 5.47237 335.206 0 328.357 0H227.297ZM244.999 55.8828V41.8438H256.161C264.197 41.8438 269.848 36.8328 269.848 29.4516C269.848 22.0703 264.234 17.3203 256.161 17.3203H236.801V55.8828H244.999ZM244.999 35.0344V24.1297H254.984C259.094 24.1297 261.539 26.2875 261.539 29.5625C261.539 32.8375 259.094 35.0344 254.984 35.0344H244.999ZM276.795 56.6266C279.94 56.6266 282.622 55.4484 284.17 53.2516H284.356V55.8828H292.182V36.7969C292.182 30.3078 287.41 26.0625 279.566 26.0625C271.344 26.0625 266.572 30.4547 266.09 36.4891H273.767C274.286 34.1453 276.24 32.6937 279.529 32.6937C282.818 32.6937 284.541 34.2922 284.541 36.7969V38.9922L276.091 39.5765C268.854 40.0891 264.752 43.4547 264.752 48.9094C264.752 54.4359 269.043 56.6266 276.795 56.6266ZM278.045 50.6641C275.34 50.6641 273.397 49.4875 273.397 47.3281C273.397 45.2406 275.191 44.1 278.564 43.8C280.482 43.6172 283.003 43.3984 284.578 43.1078V45.7578C284.578 48.6516 281.633 50.6641 278.045 50.6641ZM310.009 57.0156C308.659 61.6719 305.259 64.0156 299.348 64.0156C298.316 64.0156 296.991 63.9438 296.14 63.8375V57.125C296.991 57.2312 297.842 57.2656 298.39 57.2656C301.05 57.2656 302.523 56.0875 303.263 53.6531L303.745 52.1109L294.017 26.8797H302.598L308.695 45.8984H308.881L314.942 26.8797H323.523L313.424 53.7594L310.009 57.0156Z" fill="white"/>
              <path d="M30.3593 23.2873C24.4218 23.2873 20.1652 26.2923 17.9284 30.2124L17.7539 23.8182H0.0820312V80.0352H18.2284V53.5765C18.2284 45.5765 22.4534 41.5765 28.2409 41.5765C33.6159 41.5765 37.0784 45.1515 37.0784 51.5765V80.0352H55.2284V47.3265C55.2284 32.6557 46.6034 23.2873 30.3593 23.2873Z" fill="white"/>
              <path d="M86.0428 80.964C104.188 80.964 116.318 69.5765 116.318 52.0765C116.318 34.5765 104.188 23.2873 86.0428 23.2873C67.9553 23.2873 55.7678 34.6265 55.7678 52.0765C55.7678 69.5765 67.9553 80.964 86.0428 80.964ZM86.0428 63.2873C77.8303 63.2873 74.1553 56.7873 74.1553 52.0765C74.1553 47.4557 77.8303 40.964 86.0428 40.964C94.2178 40.964 97.9303 47.4557 97.9303 52.0765C97.9303 56.7873 94.2178 63.2873 86.0428 63.2873Z" fill="white"/>
              <path d="M169.058 52.0765C169.058 34.5765 157.683 23.2873 140.308 23.2873C122.683 23.2873 110.808 34.6265 110.808 52.1265C110.808 69.6265 123.308 80.964 140.808 80.964C154.245 80.964 165.12 73.3765 168.245 61.714H149.683C148.058 64.7873 144.87 66.5765 140.808 66.5765C134.433 66.5765 130.12 62.789 129.058 56.0765H168.87C168.995 54.7015 169.058 53.389 169.058 52.0765ZM140.433 37.2873C146.245 37.2873 150.12 40.7015 151.12 46.5765H129.37C130.62 41.0265 134.683 37.2873 140.433 37.2873Z" fill="white"/>
              <path d="M200.817 23.2873C194.879 23.2873 190.623 26.2923 188.386 30.2124L188.211 23.8182H170.54V105.035H188.686V75.5765L188.873 80.7148C191.123 79.6523 194.873 80.964 200.817 80.964C216.567 80.964 227.629 69.5765 227.629 52.0765C227.629 34.6265 216.567 23.2873 200.817 23.2873ZM196.067 63.2873C187.854 63.2873 183.936 56.7873 183.936 52.0765C183.936 47.4557 187.854 40.964 196.067 40.964C204.242 40.964 208.179 47.4557 208.179 52.0765C208.179 56.7873 204.242 63.2873 196.067 63.2873Z" fill="white"/>
            </svg>
          </button>
        </div>

        {%- comment -%} Or Divider {%- endcomment -%}
        <div class="cb-shop__checkout-or">
          <span>or</span>
        </div>

        {%- comment -%} Regular Checkout Button {%- endcomment -%}
        <button type="button" class="cb-shop__checkout-btn" data-action="checkout">
          Checkout
        </button>
      </div>
    </div>
  </div>

  {%- comment -%} Music Player {%- endcomment -%}
  {%- if enable_music_player and music_items != blank -%}
    <div class="cb-section-header">
      <h3 class="cb-section-title">{{ music_player_title | default: 'Music' }}</h3>
    </div>
  {%- endif -%}
  {%- render 'cb-v2-music-player',
    enable_music_player: enable_music_player,
    music_player_title: '',
    music_player_theme: music_player_theme,
    music_items: music_items
  -%}

  {%- comment -%} Bottom Tabs / Section Headers {%- endcomment -%}
  {%- if navigation_style == 'onepage' -%}
    {%- comment -%} ONE PAGE MODE - Section headers, all content visible {%- endcomment -%}

    <div class="cb-section-header">
      <h3 class="cb-section-title">Socials</h3>
    </div>
    <div class="cb-tab-content" data-tab-content="socials">
      {%- render 'cb-v2-social-cards',
        social_stats: social_stats,
        social_proof_cards: social_proof_cards,
        instagram_url: instagram_url,
        tiktok_url: tiktok_url,
        youtube_url: youtube_url,
        twitter_url: twitter_url
      -%}
    </div>

    <div class="cb-section-header">
      <h3 class="cb-section-title">Links</h3>
    </div>
    <div class="cb-tab-content" data-tab-content="links">
      {%- if links_json != blank -%}
        {%- assign parsed_links = links_json | parse_json -%}
        {%- if parsed_links.size > 0 -%}
          <div class="cb-links-list">
            {%- for link in parsed_links -%}
              {%- assign link_url = link.url -%}
              {%- unless link_url contains 'http://' or link_url contains 'https://' -%}
                {%- assign link_url = link_url | prepend: 'https://' -%}
              {%- endunless -%}
              <a href="{{ link_url }}" class="cb-link-card" target="_blank" rel="noopener">
                <div class="cb-link-card__content">
                  <span class="cb-link-card__title">{{ link.title }}</span>
                  <span class="cb-link-card__subtitle">View</span>
                </div>
                <svg class="cb-link-card__arrow" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M7 17L17 7M17 7H7M17 7V17"/>
                </svg>
              </a>
            {%- endfor -%}
          </div>
        {%- endif -%}
      {%- else -%}
        <div class="cb-empty-state cb-empty-state--small"><p>No links added yet.</p></div>
      {%- endif -%}
    </div>

    <div class="cb-section-header">
      <h3 class="cb-section-title">Videos</h3>
    </div>
    <div class="cb-tab-content" data-tab-content="videos">
      {%- render 'cb-v2-videos', videos_json: videos_json -%}
    </div>

    <div class="cb-section-header">
      <h3 class="cb-section-title">Exclusive</h3>
    </div>
    <div class="cb-tab-content" data-tab-content="exclusive">
      <div class="cb-empty-state cb-empty-state--small"><p>Exclusive content coming soon.</p></div>
    </div>

    <div class="cb-section-header">
      <h3 class="cb-section-title">Reviews</h3>
    </div>
    <div class="cb-tab-content" data-tab-content="reviews">
      <div class="cb-empty-state cb-empty-state--small"><p>Reviews coming soon.</p></div>
    </div>

  {%- else -%}
    {%- comment -%} TABS MODE - Existing behavior {%- endcomment -%}
    <div class="cb-bottom-tabs">
      <button class="cb-bottom-tab active" data-tab="socials">SOCIALS</button>
      <button class="cb-bottom-tab" data-tab="links">LINKS</button>
      <button class="cb-bottom-tab" data-tab="videos">VIDEOS</button>
      <button class="cb-bottom-tab" data-tab="exclusive">EXCLUSIVE</button>
      <button class="cb-bottom-tab" data-tab="reviews">REVIEWS</button>
    </div>

    <div class="cb-tab-content" data-tab-content="socials">
      {%- render 'cb-v2-social-cards',
        social_stats: social_stats,
        social_proof_cards: social_proof_cards,
        instagram_url: instagram_url,
        tiktok_url: tiktok_url,
        youtube_url: youtube_url,
        twitter_url: twitter_url
      -%}
    </div>

    <div class="cb-tab-content" data-tab-content="links" style="display: none;">
      {%- if links_json != blank -%}
        {%- assign parsed_links = links_json | parse_json -%}
        {%- if parsed_links.size > 0 -%}
          <div class="cb-links-list">
            {%- for link in parsed_links -%}
              {%- assign link_url = link.url -%}
              {%- unless link_url contains 'http://' or link_url contains 'https://' -%}
                {%- assign link_url = link_url | prepend: 'https://' -%}
              {%- endunless -%}
              <a href="{{ link_url }}" class="cb-link-card" target="_blank" rel="noopener">
                <div class="cb-link-card__content">
                  <span class="cb-link-card__title">{{ link.title }}</span>
                  <span class="cb-link-card__subtitle">View</span>
                </div>
                <svg class="cb-link-card__arrow" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M7 17L17 7M17 7H7M17 7V17"/>
                </svg>
              </a>
            {%- endfor -%}
          </div>
        {%- endif -%}
      {%- else -%}
        <div class="cb-empty-state cb-empty-state--small"><p>No links added yet.</p></div>
      {%- endif -%}
    </div>

    <div class="cb-tab-content" data-tab-content="videos" style="display: none;">
      {%- render 'cb-v2-videos', videos_json: videos_json -%}
    </div>

    <div class="cb-tab-content" data-tab-content="exclusive" style="display: none;">
      <div class="cb-empty-state cb-empty-state--small"><p>Exclusive content coming soon.</p></div>
    </div>

    <div class="cb-tab-content" data-tab-content="reviews" style="display: none;">
      <div class="cb-empty-state cb-empty-state--small"><p>Reviews coming soon.</p></div>
    </div>
  {%- endif -%}

</div>
